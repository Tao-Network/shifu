{% extends 'base.html' %}{% load i18n %}{% load gravatar %}{% block content %}      <div class="card mt-3">        <div class="card-content">          <div class="row row-group m-0">            <div class="col-12 col-lg-6 col-xl-4">              <div class="card gradient-shifter">                  <div class="card-body">                    <div class="media align-items-center">                      <div class="w-icon pr-3">                          <i class="fa fa-braille text-white"></i></div>                        <div class="media-body pl-3 border-left border-white-2">                          <span class="text-white small-font">Last Block</span>                          <span class="float-right" id="last_block_time"></span>                          <h5 class="text-white mb-0"><span id="last_block">0</span></h5>                        </div>                      </div>                  </div>                  <div class="chart-container-7"><canvas id="decorativeChart1"></canvas>                  </div>                </div>            </div>            <div class="col-12 col-lg-6 col-xl-4">              <div class="card gradient-deepblue">                  <div class="card-body">                    <div class="media align-items-center">                      <div class="w-icon pr-3">                          <i class="fa fa-certificate text-white"></i></div>                        <div class="media-body pl-3 border-left border-white-2">                          <span class="text-white small-font">Epoch  </span>                          <span class="float-right" id="last_epoch_time"></span><h5 class="text-white mb-0"><span id="epoch">0</span><span class="small-font float-center">&nbsp;&nbsp;Next:</span> <span id="epoch_time_left" class="small-font float-center">&nbsp;&nbsp;0</span>&nbsp;&nbsp;<span id="epoch_blocks_left" class="small-font float-center">&nbsp;&nbsp;0&nbsp;&nbsp;</span></h5>                        </div>                      </div>                  </div>                  <div class="chart-container-7"><canvas id="decorativeChart2"></canvas>                  </div>                </div>            </div>            <div class="col-12 col-lg-6 col-xl-4">              <div class="card gradient-ohhappiness">                  <div class="card-body">                    <div class="media align-items-center">                      <div class="w-icon pr-3">                          <i class="fa fa-lock text-white"></i></div>                        <div class="media-body pl-3 border-left border-white-2">                          <span class="text-white small-font">Total Locked</span>                          <h5 class="text-white mb-0"><span id="total_locked">0</span></h5>                        </div>                      </div>                  </div>                  <div class="chart-container-7"><canvas id="decorativeChart3"></canvas>                  </div>                </div>            </div>          </div><!--end row-->          <div class="row">            <div class="col-12 col-lg-12 col-xl-12">              <div class="card">                <div class="card-content">                  <div class="row row-group m-0">                    <div class="col-12 col-md-6 col-lg-6 col-xl-3">                      <div class="card-body text-center px-0">                        <div id="chart9"></div>                      </div>                    </div>                    <div class="col-12 col-md-6 col-lg-6 col-xl-3">                      <div class="card-body text-center px-0">                        <div id="chart10"></div>                      </div>                    </div>                    <div class="col-12 col-md-6 col-lg-6 col-xl-3">                      <div class="card-body text-center px-0">                        <div id="chart11"></div>                      </div>                    </div>                    <div class="col-12 col-md-6 col-lg-6 col-xl-3">                      <div class="card-body text-center px-0">                        <div id="chart12"></div>                      </div>                    </div>                  </div>                </div>              </div>            </div>          </div>          <div class="row">            <div class="col-12 col-lg-6 col-xl-3">                <div class="card gradient-quepal mt-2 mb-5">                 <div class="card-body">                    <div class="media align-items-center">                      <div class="w-icon"><i class="fa fa-handshake-o text-white"></i></div>                      <div class="media-body ml-3 border-left-xs border-white-2">                        <h4 class="mb-0 ml-3 text-white"><span id="total_validators">0</span></h4>                        <p class="mb-0 ml-3 extra-small-font text-white">Validators</p>                      </div>                    </div>                  </div>                </div>                <div class="card gradient-blooker">                 <div class="card-body">                    <div class="media align-items-center">                      <div class="w-icon"><i class="fa fa-users text-white"></i></div>                      <div class="media-body ml-3 border-left-xs border-white-2">                        <h4 class="mb-0 ml-3 text-white"><span id="total_voters">0</span></h4>                        <p class="mb-0 ml-3 extra-small-font text-white">Voters</p>                      </div>                    </div>                  </div>                </div>            </div>            <div class="col-12 col-lg-6 col-xl-3">              <div class="card">                <div class="card-header text-uppercase">Top Earning Accounts</div>                  <div class="">                    <div class="table-responsive">                      <table class="table align-items-center">                        <tbody>                          {% for account in request.top5_accounts %}                          <tr>                            <td id="a_{{ account }}">                            </td>                          </tr>                          {% endfor %}                        </tbody>                      </table>                  </div>                </div>              </div>               </div>            <div class="col-12 col-lg-6 col-xl-3">              <div class="card">                <div class="card-header text-uppercase">Top Earning Validators</div>                  <div class="">                    <div class="table-responsive">                      <table class="table align-items-center">                        <tbody>                          {% for account in request.top5_candidates %}                          <tr>                            <td id="v_{{ account }}">                            </td>                          </tr>                          {% endfor %}                        </tbody>                      </table>                  </div>                </div>              </div>               </div>            <div class="col-12 col-lg-6 col-xl-3 m-0">              <div class="card">                  <div class="card-body">                    <div id="spark1"></div>                  </div>                </div>              </div>               </div>          </div><!--end row-->        </div>      </div>      <div class="row">        <div class="col-12 col-lg-12">          <div class="card">            <div class="card-header"><i class="fa fa-table"></i> Validator Candidates              <div class="card-action">                <div class="dropdown">                  <a href="javascript:void();" class="dropdown-toggle dropdown-toggle-nocaret" data-toggle="dropdown">                    <i class="icon-options"></i>                  </a>                  <div class="dropdown-menu dropdown-menu-right">                    <a class="dropdown-item" href="javascript:void();">Action</a>                    <a class="dropdown-item" href="javascript:void();">Another action</a>                    <a class="dropdown-item" href="javascript:void();">Something else here</a>                    <div class="dropdown-divider"></div>                    <a class="dropdown-item" href="javascript:void();">Separated link</a>                  </div>                </div>              </div>            </div>            <div class="table-responsive">              <table class="table align-items-center table-flush table-bordered small-font"  id="validator-table">                <thead>                  <tr>                    <th>Rank</th>                    <th>Address</th>                    <th>Voters</th>                    <th>Status</th>                    <th>Lifetime ROI</th>                    {% if request.user.is_authenticated %}                                        <th>&nbsp;</th>                    {% endif %}                  </tr>                </thead>                <tbody>                </tbody>              </table>            </div>          </div>        </div>    	</div><!--End Row-->{% endblock %}{% block javascript %}{{ block.super }}  <script src="assets/plugins/bootstrap-datatable/js/jquery.dataTables.min.js"></script>  <script src="assets/plugins/bootstrap-datatable/js/dataTables.bootstrap4.min.js"></script><!-- Chart JS -->  <script src="assets/plugins/Chart.js/Chart.min.js"></script><!-- Apex chart -->  <script src="assets/plugins/apexcharts/apexcharts.js"></script>    <script src="assets/js/dashboard.js"></script><script>  var ming_addr = "http://localhost:8000";  var shifu_addr = "http://localhost:9000";  var network_info_url = shifu_addr + "/api/network_info/";  var candidates_url = shifu_addr + "/api/candidates/";  var total_supply = 158000000.000000000003;  var quorum_reached = 0;  var table = $('#validator-table').DataTable( {      "filter":   false,      "paging":   false,      "columns": [        {"orderable": "true"},        {"orderable": "false"},        {"orderable": "true"},        {"orderable": "true"},        {"orderable": "true"},        {% if request.user.is_authenticated %}                            {"orderable": "true"},        {% endif %}      ]  });  {% if not request.account.is_candidate %}    var gradient=[ '#7934f3']  {% else %}    var gradient=[ '#2af598']  {% endif %}  var sparkchart = {    chart: {      foreColor: '#e4e6eb',      type: 'area',      height: 193,      sparkline: {        enabled: true      },    },    stroke: {      width: 2,      curve: 'straight'    },    fill: {      type: 'gradient',        gradient: {            shade: 'dark',            gradientToColors: gradient,            shadeIntensity: 1,            type: 'horizontal',            opacityFrom: 1,            opacityTo: 1,            stops: [0, 100, 100, 100]        },    },    colors: ["#009efd"],    dataLabels: {          enabled: false,      },    tooltip: {        enabled: true,        theme: 'dark',        style: {          fontSize: '12px',          fontFamily: undefined        },        x: {            show: true,            format: 'dd MMM',            formatter: undefined,        },        y: {            show: true,            formatter: undefined,            title: {                formatter: (seriesName) => seriesName,            },        },        marker: {            show: true,        },        items: {           display: [],        },        fixed: {            enabled: false,            position: 'topRight',            offsetX: 0,            offsetY: 0,        },    },    series: [],    labels: [],    noData: {      text: 'Loading...'    },    yaxis: {      min: 0    },    subtitle: {      text: '',      offsetX: 0,      offsetY: 15,      style: {        fontSize: '24px',        cssClass: 'apexcharts-yaxis-title'      }    },    title: {      text: 'Last 30 Days Earnings',      offsetX: 0,      style: {        fontSize: '14px',        cssClass: 'apexcharts-yaxis-title'      }    }}const spark1 = new ApexCharts(document.querySelector("#spark1"), sparkchart);var chart9 = new ApexCharts(document.querySelector("#chart9"),options9);var chart10 = new ApexCharts(document.querySelector("#chart10"),options10);var chart11 = new ApexCharts(document.querySelector("#chart11"),options11);var chart12 = new ApexCharts(document.querySelector("#chart12"),options12);const pageUpdate = ()=>{    $.ajax({            type: 'GET',            url: network_info_url,            dataType: 'json',            success: function (result) {              $('#last_block').html(nf.format(parseFloat(result.current_block).toFixed(4)));              $('#last_block_time').html(result.block_timestamp);              blocks_until_next_epoch = "" + Math.abs(result.current_block - (result.epoch + 1) * 360 ) + " blocks ";              time_until_next_block = (Math.abs(result.current_block - (result.epoch + 1) * 360 ) * 5);              $('#epoch').html(nf.format(parseFloat(result.epoch).toFixed(4)));              $('#epoch_time_left').html(secondsToHms(time_until_next_block));              $('#epoch_blocks_left').html(blocks_until_next_epoch);              $('#last_epoch_time').html(result.epoch_start_time);              $('#total_validators').html(result.validator_count-1);              $('#total_voters').html(result.voter_count);              var contract_balance = 0;              var bal = accountBalance(contract_address).then(function(b){                contract_balance = web3.utils.fromWei(b, 'ether')                $('#total_locked').html(nf.format(parseFloat(contract_balance).toFixed(4)) + " TAO");                                    chart9.updateSeries([ ((contract_balance / total_supply) * 100).toFixed(2) ]);              });                              chart11.updateSeries([ result.voter_avg_roi ]);              chart12.updateSeries([ result.validator_avg_roi ]);            },    });     $.ajax({            type: 'GET',            url: candidates_url,            dataType: 'json',            success: function (result) {              result = result['candidates']              data = [];              stake = {};              result.forEach(function(i,x){                var button_html = '<button type="button" id="button-vote" class="btn btn-success  waves-effect waves-light m-1" data-validator="' + i.address + '" data-roi="' + i.roi + '%" data-toggle="modal" data-target="#votemodal">Vote</button>'                                    if (i.status == 'MASTERNODE') {                  status = '<span class="badge badge-pill badge-success shadow-success m-1">ACTIVE</span>'                } else if (i.status == 'SLASHED') {                  status = '<span class="badge badge-pill badge-dark shadow-warning m-1">SLASHED</span>'                } else {                  if (i.status == 'RESIGNED')                    button_html = '';                  status = '<span class="badge badge-pill badge-info shadow-warning m-1">'+i.status+'</span>'                }                {% if request.account.is_candidate and request.user == request.account.owner %}                var button_html = button_html + '<button type="button" id="button-resign" class="btn btn-success  waves-effect waves-light m-1" data-validator="' + i.address + '" data-roi="' + i.roi + '%" data-toggle="modal" data-target="#votemodal">Vote</button>'                                    {% endif %}                data.push([                  i.rank,                  profile_link(i.address),                  i.voters,                  status,                  i.roi + "%",                {% if request.user.is_authenticated %}                                      button_html,                {% endif %}                ])              })              table.clear();              table.rows.add(data);              table.draw();              quorum_reached = ((result.length / 150)*100).toFixed(2);              if (quorum_reached > 100) quorum_reached = 100;              chart10.updateSeries([ quorum_reached ])              $(".se-pre-con").fadeOut("slow");              $(".btn-success").on("click", function(){                $("#vote-amount").focus();                $("#vote-amount").click();                $("#vote-balance").html("{{ request.user.account.balance }}");                $('#vote-address').html(this.dataset.validator);                $('#vote-staked').html(this.dataset.staked);                $('#vote-roi').html(this.dataset.roi);              });            },    });    $.ajax({        type: "GET",        url: "{% url 'total_earnings_api' %}",        data: '{}',        contentType: "application/json; charset=utf-8",        dataType: "json",        success: function (response) {            var data = [];            var label = [];            var nf = Intl.NumberFormat();            response['earnings'].forEach(function(i,d){              label.push(i.date + " " + nf.format(parseFloat(i.total).toFixed(4)) +" TAO");              data.push({x:i.date,y:i.total});            });            var subtitle=nf.format(parseFloat(response['total_earnings']).toFixed(8)) + " TAO";            options = {                labels: label,                subtitle: {                  text: subtitle,              }            };            spark1.updateOptions(options);             var series = [{                name: 'Earnings Per Day',                data: data,              }];            spark1.updateSeries(series);        }    });    }  $( document ).ready(function() {      {% for account in request.top5_candidates %}    $('#v_{{ account }}').html(profile_link('{{ account }}'));    {% endfor %}    {% for account in request.top5_accounts %}    $('#a_{{ account }}').html(profile_link('{{ account }}'));    {% endfor %}    spark1.render();    chart9.render();    chart10.render();    chart11.render();    chart12.render();    pageUpdate();    var i = setInterval(function() {      pageUpdate();    }, 5000);  });</script>{% endblock javascript %}