{% load static %}
{% load gravatar %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
  <meta name="description" content=""/>
  <meta name="author" content=""/>
  <!-- Primary Meta Tags -->
  <title>Shifu - The Decentralized Finance Application for Tao Network Governance</title>
  <meta name="title" content="Shifu - The Decentralized Finance Application for Tao Network Governance">
  <meta name="description" content="Manage your Tao stake! Voting for network validators earns money every 30 minutes, directly into your MetaMask account! Control the network through DeFi!">
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://shifu-beta.tao.network/">
  <meta property="og:title" content="Shifu - The Decentralized Finance Application for Tao Network Governance">
  <meta property="og:description" content="Manage your Tao stake! Voting for network validators earns money every 30 minutes, directly into your MetaMask account! Control the network through DeFi!">
  <meta property="og:image" content="https://shifu-beta.tao.network/assets/images/preview.png">
  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://shifu-beta.tao.network/">
  <meta property="twitter:title" content="Shifu - The Decentralized Finance Application for Tao Network Governance">
  <meta property="twitter:description" content="Manage your Tao stake! Voting for network validators earns money every 30 minutes, directly into your MetaMask account! Control the network through DeFi!">
  <meta property="twitter:image" content="https://shifu-beta.tao.network/assets/images/preview.png">
  <!-- loader-->
  <link href={% static "/css/pace.min.css" %} rel="stylesheet" type="text/css" />
  <!--favicon-->
  <link rel="icon" href={% static "/images/favicon.ico" %} type="image/x-icon">
  <!-- Vector CSS -->
  <link href={% static "/plugins/vectormap/jquery-jvectormap-2.0.2.css" %} rel="stylesheet" type="text/css" />
  <!-- simplebar CSS-->
  <link href={% static "/plugins/simplebar/css/simplebar.css" %} rel="stylesheet" type="text/css"/>
  <!-- Bootstrap core CSS-->
  <link href={% static "/css/bootstrap.min.css" %} rel="stylesheet" type="text/css"/>
  <!-- animate CSS-->
  <link href={% static "/css/animate.css" %} rel="stylesheet" type="text/css" %}/>
  <!-- Icons CSS-->
  <link href={% static "/css/icons.css" %} rel="stylesheet" type="text/css" %}/>
  <!-- Horizontal CSS-->
  <link href={% static "/css/horizontal-menu.css" %} rel="stylesheet" type="text/css"/>
  <!-- Custom Style-->
  <link href={% static "/css/app-style.css" %} rel="stylesheet" type="text/css"/>
  <style>
    #btnNetworkTrigger,#btnBetaTrigger{
      display:none;
    }
  </style>
  <!-- Bootstrap core JavaScript-->
  <script src="{% static '/js/jquery.min.js' %}"></script>
  <script src="{% static '/js/popper.min.js' %}"></script>
  <script src="{% static '/js/bootstrap.min.js' %}"></script>
</head>



<body class="bg-theme bg-theme2">

  <div class="se-pre-con"></div>
                <div class="modal fade" id="withdrawalmodal" aria-modal="true">
                  <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content bg-success border-success">
                      <div class="modal-header border-light-2">
                        <h5 class="modal-title text-white">You have withdrawals pending!</h5>
                        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">×</span>
                        </button>
                      </div>
                      <div class="modal-body text-white">
                        <p>You have a withdrawal pending. Click "Start Withdrawal!" below to send a withdrawal request.</p>
                        <p>This message will appear for every withdrawal you have which is pending and will continue to appear until all pending withdrawals are processed.</p>
                      </div>
                      <div class="modal-footer border-light-2">
                        <button type="button" class="btn btn-link text-white" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
                        <button id="btn-withdraw" type="button" class="btn btn-link text-white"><i class="fa fa-check-square-o"></i> Start Withdrawal!</button>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="modal fade" id="dangermodal" aria-modal="true">
                  <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content border-danger">
                      <div class="modal-header bg-danger">
                        <h5 class="modal-title text-white">WARNING - THIS SOFTARE IS IN BETA</h5>
                        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">×</span>
                        </button>
                      </div>
                      <div class="modal-body">
                        <p>This platform is currently in beta testing. Your funds are safe in your MetaMask wallet or in the smart contract. There's zero chance of loss of funds due to a malfunction of the website. User error is always possible.</p>
                        <p>The interface may behave oddly at times. Thank you for your patience!  You have been warned.</p>
                        <p>
                        Happy staking!</p>
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-dismiss="modal" id="danger-close"><i class="fa fa-times"></i> Continue</button>
                      </div>
                    </div>
                  </div>
                </div>
      <div class="modal fade" id="waitingmodal" style="display: none;" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content gradient-royal border-primary">
            <div class="modal-header border-light-2">
              <h5 class="modal-title text-white">Waiting for User</h5>
              <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body text-white">
              <p>Waiting for user interaction to continue...</p>
            </div>
          </div>
        </div>
      </div><!--End Modal -->

      <div class="modal fade" id="submitmodal" style="display: none;" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content gradient-royal border-primary">
            <div class="modal-header border-light-2">
              <h5 class="modal-title text-white">Waiting for Network</h5>
              <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body text-white">
              <p>Waiting for network to confirm transaction.</p>
              <p>This may take up to 30 seconds.</p>
            </div>
          </div>
        </div>
      </div><!--End Modal -->

      <div class="modal fade" id="networkerrormodal" style="display: none;" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content bg-danger border-danger">
            <div class="modal-header border-light-2">
              <h5 class="modal-title text-white">TRANSACTION FAILED</h5>
              <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body text-white">
              <p>The transaction failed to confirm!</p>
            </div>
            <div class="modal-footer border-light-2">
              <button type="button" class="btn btn-link text-white" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
            </div>
          </div>
        </div>
      </div><!--End Modal -->
      <!--Network Modal -->
      <div class="modal fade" id="networkmodal" style="display: none;" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content border-info">
            <div class="modal-header bg-info">
              <h5 class="modal-title text-white">Wrong network selected!</h5>
            </div>
            <div class="modal-body">
              <p>Oops! You have the wrong network selected! Please open MetaMask and selecte the Tao network! If you need help, <a href="https://tao.network/getting-started/" target="_blank">click here.</a></p>
            </div>
            <div class="modal-footer">
            </div>
          </div>
        </div>
      </div><!--End Modal -->
      <!--Vote Modal -->
      <div class="modal fade" id="votemodal" style="display: none;" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
          <div class="modal-content border-info">
            <div class="modal-header bg-info">
              <h5 class="modal-title text-white">Vote!</h5>
              <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">×</span>
              </button>
            </div>
            <div class="modal-body">
              <table class="table align-items-center table-flush table-borderless" id="ivote-table">
                <tbody>
                  <tr>
                    <td>Address</td><td><span class="text-white mb-0" id="vote-address"></span></td>
                  </tr>
                  <tr>
                    <td>Staked</td><td><span class="text-white mb-0" id="vote-staked"></span></td>
                  </tr>
                  <tr>
                    <td>Lifetime ROI</td><td><span class="text-white mb-0" id="vote-roi"></span></td>
                  </tr>
                  <tr>
                    <td>Your Balance</td><td><span class="text-white mb-0" id="vote-balance"></span></td>
                  </tr>
                </tbody>
              </table>
              <p>Enter the amount you wish to vote below (minimum 100TAO)</p>
              <input type="text" class="form-control form-control-rounded" id="vote-amount" value="100">
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-light" data-dismiss="modal" ><i class="fa fa-times"></i> Cancel</button>
              <button id="submit-vote" type="button" class="btn btn-light" data-dismiss="modal" ><i class="fa fa-handshake-o"></i> Vote!</button>
            </div>
          </div>
        </div>
      </div><!--End Modal -->

      <!--Unvote Modal -->
      <div class="modal fade" id="unvotemodal" style="display: none;" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
          <div class="modal-content border-info">
            <div class="modal-header bg-info">
              <h5 class="modal-title text-white">Unvote</h5>
              <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">×</span>
              </button>
            </div>
            <div class="modal-body">
              <table class="table align-items-center table-flush table-borderless" id="unvote-table">
                <tbody>
                  <tr>
                    <td>Address</td><td><span class="text-white mb-0" id="unvote-address"></span></td>
                  </tr>
                  <tr>
                    <td>Staked</td><td><span class="text-white mb-0" id="unvote-staked"></span></td>
                  </tr>
                </tbody>
              </table>
              <p>Enter the amount you wish to unvote below (minimum 100TAO)</p>
              <input type="text" class="form-control form-control-rounded" id="unvote-amount" value="100">
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-light" data-dismiss="modal" ><i class="fa fa-times"></i> Cancel</button>
              <button id="unvote-button" type="button" class="btn btn-light" data-dismiss="modal" ><i class="fa fa-handshake-o"></i> Unvote!</button>
            </div>
          </div>
        </div>
      </div><!--End Modal -->

      <!--Propose Modal -->
      <div class="modal fade" id="proposemodal" style="display: none;" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
          <div class="modal-content border-info">
            <div class="modal-header bg-info">
              <h5 class="modal-title text-white">Propose</h5>
              <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">×</span>
              </button>
            </div>
            <div class="modal-body">
              <p>Enter the address of the new validator</p>
              <p>Note: you must have 100,000 TAO in your wallet or the transaction will fail!</p>
              <input type="text" class="form-control form-control-rounded" id="validator-address" placeholder="Enter your validator coinbase address">
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-light" data-dismiss="modal" ><i class="fa fa-times"></i> Cancel</button>
              <button id="propose-button" type="button" class="btn btn-light" data-dismiss="modal" ><i class="fa fa-handshake-o"></i> Propose!</button>
            </div>
          </div>
        </div>
      </div><!--End Modal -->

      <!--Resign Modal -->
      <div class="modal fade" id="resignmodal" style="display: none;" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
          <div class="modal-content border-info">
            <div class="modal-header bg-info">
              <h5 class="modal-title text-white">Resign</h5>
              <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">×</span>
              </button>
            </div>
            <div class="modal-body">
              <table class="table align-items-center table-flush table-borderless" id="unvote-table">
                <tbody>
                  <tr>
                    <td>Address</td><td><span class="text-white mb-0" id="resign-address"></span></td>
                  </tr>
                </tbody>
              </table>
              <p>Click the "Resign" button below to confirm the resignation.</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-light" data-dismiss="modal" ><i class="fa fa-times"></i> Cancel</button>
              <button id="resign-button" type="button" class="btn btn-light" data-dismiss="modal" ><i class="fa fa-handshake-o"></i> Resign!</button>
            </div>
          </div>
        </div>
      </div><!--End Modal -->

      <!--Governance Modal -->


                <div class="modal fade" id="governancemodal" style="display: none;" aria-hidden="true">

                  <div class="modal-dialog modal-dialog-centered">

                    <div class="modal-content border-info">

                      <div class="modal-header bg-info">

                        <h5 class="modal-title text-white">What is Governance?</h5>

                        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">

                          <span aria-hidden="true">×</span>

                        </button>

                      </div>

                      <div class="modal-body">

                        <p>Layer 1 (or base) blockchain protocols maintain data consistency across hundreds of nodes via consensus. Governance is the method by which the rules which those nodes which determine valid consensus are selected. These potential validator nodes are called Candidates.</p>

                      </div>

                      <div class="modal-footer">

                        <button type="button" class="btn btn-light" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>

                      </div>

                    </div>

                  </div>

                </div><!--End Modal -->

      <!--Governance Modal -->


                <div class="modal fade" id="candidatemodal" style="display: none;" aria-hidden="true">

                  <div class="modal-dialog modal-dialog-centered">

                    <div class="modal-content border-info">

                      <div class="modal-header bg-info">

                        <h5 class="modal-title text-white">What are Candidates?</h5>

                        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">

                          <span aria-hidden="true">×</span>

                        </button>

                      </div>

                      <div class="modal-body">

                        <p>Candidates are full nodes which, when selected by voters, are permitted to sign and validate new blocks of transactions. When a Candidate is selected it becomes a Validator. There are 150 total Validtors allowed at maximum at any given time and it requires a minimum of 100,000 TAO to become a Validator Candidate.</p>
                        <p>The 100,000 TAO required to become a Candidate is locked in the governance smart contract and cannot be removed until the Candidate resigns.</p>
                      </div>

                      <div class="modal-footer">

                        <button type="button" class="btn btn-light" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>

                      </div>

                    </div>

                  </div>

                </div><!--End Modal -->


      <!--Voter Modal -->


                <div class="modal fade" id="votermodal" style="display: none;" aria-hidden="true">

                  <div class="modal-dialog modal-dialog-centered">

                    <div class="modal-content border-info">

                      <div class="modal-header bg-info">

                        <h5 class="modal-title text-white">What are Voters?</h5>

                        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">

                          <span aria-hidden="true">×</span>

                        </button>

                      </div>

                      <div class="modal-body">

                        <p>Voters are participants in the network who designate their TAO tokens in support of a specific validator Candidate in return for a share in the rewards proportional to the amount they designate.  This designated amount is called a "Stake".</p>
                        <p>A minimum 100 TAO is required in order to participate. A candidate may resign and their tokens will be returned to them in 75 days.</p>
                      </div>

                      <div class="modal-footer">

                        <button type="button" class="btn btn-light" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>

                      </div>

                    </div>

                  </div>

                </div><!--End Modal -->

      <!--Voter Modal -->


                <div class="modal fade" id="stakemodal" style="display: none;" aria-hidden="true">

                  <div class="modal-dialog modal-dialog-centered">

                    <div class="modal-content border-info">

                      <div class="modal-header bg-info">

                        <h5 class="modal-title text-white">What is a Stake?</h5>

                        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">

                          <span aria-hidden="true">×</span>

                        </button>

                      </div>

                      <div class="modal-body">

                        <p>A Stake is an amount of tokens designated to a Candidate by a Voter representing an amount of financial support for that validator which entitles the Voter to a proportional share of rewards.</p>
                        <p>A Stake may be "unvoted" and returned the the Voter, which takes about 5 days.</p>
                      </div>

                      <div class="modal-footer">

                        <button type="button" class="btn btn-light" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>

                      </div>

                    </div>

                  </div>

                </div><!--End Modal -->


 <div id="wrapper">

 
<!--start top-wrapper-->
<div class="top-wrapper"> 
  <!--Start topbar header-->

<header class="topbar-nav">

 <nav class="navbar navbar-expand">
  <div class="brand-logo">
    <img src="{% static '/images/logo-icon.png' %}" class="logo-icon" alt="logo icon">
    <h5 class="logo-text">Shifu .:. Tao Governance</h5>
   </div>
  
  <ul class="navbar-nav align-items-center right-nav-link ml-auto">
    <li class="nav-item">
      <a href="javascript:void()" class="btn-social btn-social-circle btn-twitter waves-effect waves-light m-1"><i class="fa fa-twitter"></i></a>
    </li>
    <li class="nav-item">
      <a href="javascript:void()" class="btn-social btn-social-circle btn-github waves-effect waves-light m-1"><i class="fa fa-github"></i></a>
    </li>
    <li class="nav-item">
      <a href="javascript:void()" class="btn-social btn-social-circle btn-youtube waves-effect waves-light m-1"><i class="fa fa-youtube"></i></a>
    </li>
    <li class="nav-item">
      <a href="javascript:void()" class="btn-social btn-social-circle btn-telegram waves-effect waves-light m-1"><i class="fa fa-telegram"></i></a>
    </li>
    {% if not request.user.is_authenticated %}
    <li class="nav-item" id="button-login">
      <a href="{% url 'autologin' %}" class="btn-social-text btn-google-plus waves-effect waves-light m-1"><i class="zmdi zmdi-power"></i> <span>Login with MetaMask</span></a>
    </li>
    {% else %}
    <li class="nav-item dropdown">
      <a class="nav-link dropdown-toggle dropdown-toggle-nocaret position-relative" data-toggle="dropdown" href="javascript:void();">
        <span class="user-profile">
              {% gravatar request.user.username 48 %}
      </a>
      <ul class="dropdown-menu dropdown-menu-right">
       <li class="dropdown-item user-details">
        <a href="{% url 'profile' %}">
           <div class="media">
             <div class="avatar">
              <img class="align-self-start mr-3" alt="user avatar" src="{% gravatar_url request.user.username 40 %}">
            <div class="media-body">
            <h6 class="mt-2 user-title">{{ request.user.username|slice:":8" }}...{{ request.user.username|slice:"-8:" }}</h6>
            <p class="user-subtitle">{{ request.user.email }}</p>
            </div>
           </div>
          </a>
        </li>
        <li class="dropdown-divider"></li>
        <li class="dropdown-item"><i class="fa fa-bank"></i><a href="javascript:void();"  data-toggle="modal" data-target="#proposemodal">Become a Candidate</a></li>
        <li class="dropdown-divider"></li>
        <li class="dropdown-item"><a href="{% url 'profile' %}"><i class="zmdi zmdi-balance-wallet mr-3"></i>Profile</a></li>
        <li class="dropdown-divider"></li>
        <li class="dropdown-item"><a href="{% url 'logout' %}"><i class="zmdi zmdi-power mr-3"></i>Logout</a></li>
      </ul>
    </li>
    {% endif %}
  </ul>

</nav>

</header>

<!--End topbar header-->

<!-- start horizontal Menu -->

    <nav>

        <!-- Menu Toggle btn-->
        <div class="menu-toggle align-items-center">
            <h3>Menu</h3>
            <button class="btn" type="button" id="mobile-btn">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>

    
<!--start nav container-->
    <div class="nav-container">
      <!-- mobile close btn-->
        <div class="close-btn">
         <i class="zmdi zmdi-close"></i>
        </div>
      
        <ul id="respMenu" class="horizontal-menu">

    

    <li>

                <a href="/">

                    <i class="zmdi zmdi-view-dashboard" aria-hidden="true"></i>

                    <span class="title">Dashboard</span>

                

                </a>
      </li>
    {% if request.user.is_authenticated %}

      <li>

                <a href="javascript:;" data-toggle="modal" data-target="#proposemodal">
                    <i class="fa fa-bank" aria-hidden="true"></i>

                    <span class="title">Become a Candidate</span>

                

                </a>
      </li>
      {% endif %}
      <li>

                  <a href="javascript:;">

                      <i class="fa fa-question"></i>

                      <span class="title">Help</span>

          



                  </a>

                  <!-- Level Two-->

                  <ul>

                      <li><a href="javascript:;"  data-toggle="modal" data-target="#governancemodal"><i class="zmdi zmdi-dot-circle-alt"></i> Governance</a></li>

                      <li><a href="javascript:;" data-toggle="modal" data-target="#candidatemodal"><i class="zmdi zmdi-dot-circle-alt"></i> Candidates</a></li>

                      <li><a href="javascript:;" data-toggle="modal" data-target="#votersmodal"><i class="zmdi zmdi-dot-circle-alt"></i> Voters</a></li>

                      <li><a href="javascript:;" data-toggle="modal" data-target="#stakemodal"><i class="zmdi zmdi-dot-circle-alt"></i> Stake</a></li>

                      <li><a href="{% url 'schema-swagger-ui' %}" target="_blank"><i class="zmdi zmdi-dot-circle-alt"></i> API</a></li>

                  </ul>

        </li>
    </ul>
    
    </div><!--end nav container-->

    </nav>

    <!-- end horizontal Menu -->



      </div>
  <!--end top-wrapper-->
 {% if messages %}
    {% for message in messages %}

      <div class="alert alert-icon-warning alert-dismissible mb-0 {% if message.tags %}alert-{{ message.tags }}{% endif %}" role="alert">

        <button type="button" class="close" data-dismiss="alert">×</button>

        <div class="alert-icon icon-part-warning">

          <i class="fa fa-exclamation-triangle"></i>

        </div>

        <div class="alert-message">

          <span><strong>Warning!</strong> {{ message }}</span>

        </div>

      </div>
    {% endfor %}
  {% endif %}

  <div class="content-wrapper">

    <div class="container-fluid">
      <!--Start Dashboard Content-->
{% block content %}
{% endblock %}
      <!--End Dashboard Content-->
      <!--start overlay-->
      <div class="overlay mobile-btn"></div>
      <!--end overlay-->
    </div>

    <!-- End container-fluid-->

    

    </div><!--End content-wrapper-->


   <!--Start Back To Top Button-->

    <a href="javaScript:void();" class="back-to-top"><i class="fa fa-angle-double-up"></i> </a>

    <!--End Back To Top Button-->
                <button class="btn btn-primary btn-lg d-none" id="btnNetworkTrigger" data-toggle="modal" data-target="#networkmodal">
                <button class="btn btn-primary btn-lg d-none" id="btnBetaTrigger" data-toggle="modal" data-target="#dangermodal">
                <button class="btn btn-primary btn-lg d-none" id="btnWithdrawalTrigger" data-toggle="modal" data-target="#withdrawalmodal">


  </div><!--End wrapper-->




 <!-- simplebar js -->

  <script src={% static "/plugins/simplebar/js/simplebar.js" %}></script>

  <!-- horizontal-menu js -->

  <script src={% static "/js/horizontal-menu.js" %}></script>

  <!-- Custom scripts -->

  <script src={% static "/js/app-script.js" %}></script>

  <!-- Chart js -->

  
  <!-- Sparkline JS -->

  <script src={% static "/plugins/sparkline-charts/jquery.sparkline.min.js" %}></script>

  <script src={% static "/plugins/jquery-knob/excanvas.js" %}></script>

  <!-- Your stuff: Third-party javascript libraries go here -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.3.1/web3.min.js" integrity="sha512-96ZCo0pzD4x2MuBZCB4ipirFKs/X/xB2diGU/A7zpfaltISM309KN79pyWe4l9IdtOlzitRltfVcxgdTEbcnvQ==" crossorigin="anonymous"></script>
<script src = "{% static '/js/md5.js' %}">
</script>
  <script src="{% static '/js/index.js' %}"></script>
    
{% block javascript %}

<script>
  if (window.ethereum) {
    web3 = new Web3(window.ethereum);
  } else {
    web3 = new Web3(new Web3.providers.HttpProvider("https://rpc.tao.network"));
  }
  var nf = Intl.NumberFormat();

  {% if request.user.is_authenticated %}
  const user_address = web3.utils.toChecksumAddress('{{ request.user.username }}');
  {% else %}
  const user_address = null;
  {% endif %}
  const contract_abi = [{"constant":false,"inputs":[{"name":"_candidate","type":"address"}],"name":"propose","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":false,"inputs":[{"name":"_candidate","type":"address"},{"name":"_cap","type":"uint256"}],"name":"unvote","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getCandidates","outputs":[{"name":"","type":"address[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_blockNumber","type":"uint256"}],"name":"getWithdrawCap","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_candidate","type":"address"}],"name":"getVoters","outputs":[{"name":"","type":"address[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getWithdrawBlockNumbers","outputs":[{"name":"","type":"uint256[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_candidate","type":"address"},{"name":"_voter","type":"address"}],"name":"getVoterCap","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"candidates","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_blockNumber","type":"uint256"},{"name":"_index","type":"uint256"}],"name":"withdraw","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_candidate","type":"address"}],"name":"getCandidateCap","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_candidate","type":"address"}],"name":"vote","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[],"name":"candidateCount","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"voterWithdrawDelay","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_candidate","type":"address"}],"name":"resign","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_candidate","type":"address"}],"name":"getCandidateOwner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"maxValidatorNumber","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"candidateWithdrawDelay","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_candidate","type":"address"}],"name":"isCandidate","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"minCandidateCap","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"minVoterCap","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"_candidates","type":"address[]"},{"name":"_caps","type":"uint256[]"},{"name":"_firstOwner","type":"address"},{"name":"_minCandidateCap","type":"uint256"},{"name":"_minVoterCap","type":"uint256"},{"name":"_maxValidatorNumber","type":"uint256"},{"name":"_candidateWithdrawDelay","type":"uint256"},{"name":"_voterWithdrawDelay","type":"uint256"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"name":"_voter","type":"address"},{"indexed":false,"name":"_candidate","type":"address"},{"indexed":false,"name":"_cap","type":"uint256"}],"name":"Vote","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"_voter","type":"address"},{"indexed":false,"name":"_candidate","type":"address"},{"indexed":false,"name":"_cap","type":"uint256"}],"name":"Unvote","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"_owner","type":"address"},{"indexed":false,"name":"_candidate","type":"address"},{"indexed":false,"name":"_cap","type":"uint256"}],"name":"Propose","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"_owner","type":"address"},{"indexed":false,"name":"_candidate","type":"address"}],"name":"Resign","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"_owner","type":"address"},{"indexed":false,"name":"_blockNumber","type":"uint256"},{"indexed":false,"name":"_cap","type":"uint256"}],"name":"Withdraw","type":"event"}];
  const contract_address = '0x0000000000000000000000000000000000000088';
  var gasPrice=4700000;
  const gas=2000000;
  const validator_contract = new web3.eth.Contract(contract_abi, contract_address);
$( document ).ready(function() {

  const withdrawalPending = (address) => {
    return validator_contract.methods.getWithdrawBlockNumbers().call({
            from: address
        }).then((result) => {
          let x = getBlock().then(function(blk){
            return blk.number 
          }).then(function(blockNumber){
              let map = result.map((it, idx) => {
                  it = it.toString()
                  if (parseInt(it) < blockNumber && it != "0") {
                    return [ parseInt(it), parseInt(idx) ];
                  }
              })
              var r = false;
              map.forEach(function(i){
                if (i !== undefined){
                  if (i[1].toString()!='0'){
                    if (!r){
                      // you have withdrawals pending
                      $('#btnWithdrawalTrigger').click();
                      $('#btnWithdrawalTrigger').val([i[0],i[1]]);
                      r = true;
                    }
                  }
                }
              })
          })
        })  
  }

  $('#btn-withdraw').on('click',function(){
    web3.eth.getGasPrice(function(e, r) { 
      gasPrice = r;
      account = web3.utils.toChecksumAddress('{{request.user.username}}');
      $('#waitingmodal').modal('toggle');
      blk = $('#btnWithdrawalTrigger').val();
      blk = blk.split(',')
      try{
        validator_contract.methods.withdraw(parseInt(blk[0]),parseInt(blk[1])).send({from: account,gas,gasPrice})
          .on('transactionHash', function(hash){
            $('#waitingmodal').modal('hide');
            $('#submitmodal').modal('toggle');
          })
          .on('receipt', function(receipt){
            location.reload();
          })
          .on('error', function(error, receipt) { // If the transaction was rejected by the network with a receipt, the second parameter will be the receipt.
            $('#waitingmodal').modal('hide');
            $('#submitmodal').modal('hide');
            $('#networkerrormodal').modal('toggle');
            console.log(error);
          });      
      } catch(err) {
        console.log(err);
      }
    });
  });
  $("#vote-amount").inputFilter(function(value) {
    return /^\d*$/.test(value) && (parseInt(value) >= 0 || parseInt(value) <= accountBalance('{{ request.user.username }}')); });

  $("#unvote-amount").inputFilter(function(value) {
    return /^\d*$/.test(value) && (parseInt(value) >= 0 || parseInt(value) <= accountBalance('{{ request.user.username }}')); });

  $('#propose-button').on('click',function(){
    web3.eth.getGasPrice(function(e, r) { 
      gasPrice = r;
      validator = web3.utils.toChecksumAddress($('#validator-address').val());
      amount = web3.utils.toWei('100000', 'ether');
      $('#waitingmodal').modal('toggle');
      try{
        validator_contract.methods.propose(validator).send({from: user_address,value:amount,gas,gasPrice})
          .on('transactionHash', function(hash){
            $('#waitingmodal').modal('hide');
            $('#submitmodal').modal('toggle');
          })
          .on('receipt', function(receipt){
            location.reload();
          })
          .on('error', function(error, receipt) { // If the transaction was rejected by the network with a receipt, the second parameter will be the receipt.
            $('#waitingmodal').modal('hide');
            $('#submitmodal').modal('hide');
            $('#networkerrormodal').modal('toggle');
            console.log(error);
          });      
      } catch(err) {
        console.log(err);
      }
    });

  });
  $('#resign-button').on('click',function(){
    web3.eth.getGasPrice(function(e, r) { 
      gasPrice = r;
      validator = web3.utils.toChecksumAddress($('#resign-address').html());
      $('#waitingmodal').modal('toggle');
      validator_contract.methods.resign(validator).send({from: user_address,gas,gasPrice})
        .on('transactionHash', function(hash){
          $('#waitingmodal').modal('hide');
          $('#submitmodal').modal('toggle');
        })
        .on('receipt', function(receipt){
          location.reload();
        })
        .on('error', function(error, receipt) { // If the transaction was rejected by the network with a receipt, the second parameter will be the receipt.
          $('#waitingmodal').modal('hide');
          $('#submitmodal').modal('hide');
          $('#networkerrormodal').modal('toggle');
          console.log(error);
        });
    });

  });
  $('#unvote-button').on('click',function(){
    web3.eth.getGasPrice(function(e, r) { 
      gasPrice = r;
      validator = web3.utils.toChecksumAddress($('#unvote-address').html());
      amount = web3.utils.toWei($('#unvote-amount').val(), 'ether');
      $('#waitingmodal').modal('toggle');
      validator_contract.methods.unvote(validator, amount).send({from: user_address,gas,gasPrice})
        .on('transactionHash', function(hash){
          $('#waitingmodal').modal('hide');
          $('#submitmodal').modal('toggle');
        })
        .on('receipt', function(receipt){
          location.reload();
        })
        .on('error', function(error, receipt) { // If the transaction was rejected by the network with a receipt, the second parameter will be the receipt.
          $('#waitingmodal').modal('hide');
          $('#submitmodal').modal('hide');
          $('#networkerrormodal').modal('toggle');
          console.log(error);
        });
    });

  });
  $('#submit-vote').on('click',function(){
    web3.eth.getGasPrice(function(e, r) { 
      gasPrice = r;
      validator = web3.utils.toChecksumAddress($('#vote-address').html());
      amount = web3.utils.toWei($('#vote-amount').val(), 'ether');
      $('#waitingmodal').modal('toggle');
      validator_contract.methods.vote(validator).send({from: user_address,value:amount,gas,gasPrice})
        .on('transactionHash', function(hash){
          $('#waitingmodal').modal('hide');
          $('#submitmodal').modal('toggle');
        })
        .on('receipt', function(receipt){
          location.reload();
        })
        .on('error', function(error, receipt) { // If the transaction was rejected by the network with a receipt, the second parameter will be the receipt.
          $('#waitingmodal').modal('hide');
          $('#submitmodal').modal('hide');
          $('#networkerrormodal').modal('toggle');
          console.log(error);
        });
    });

  });
  if(localStorage.getItem('popState') != 'shown'){
      $('#btnBetaTrigger').click();
      localStorage.setItem('popState','shown')
  }

  const pending = withdrawalPending('{{request.user.username}}')
});
</script>
{% endblock javascript %}
  <!-- Index js -->

</body>

</html>

